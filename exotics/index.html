<!DOCTYPE html>
<html>
<head>
<style>
.imageWrapper {
  position: relative;
}
.overlayImage {
  position: absolute;
  top: 0;
  left: 0;
  margin: auto;
}
.card {
 /*This is the actual background*/
  box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
  transition: 0.3s;
  border-radius: 5px; 
  background: #000000;
  color: #FFFFFF;
}

.card:hover {
  box-shadow: 0 8px 16px 0 rgba(0,0,0,0.6);
}

/* Add some padding inside the card container */
.container {
  height: 76px;
  	margin: 4px;
}
img {
	padding: 6px;
	width: 49px;
	height: 64px;	
}
/* Create three equal columns that floats next to each other */
.column {
  float: left;
  width: 45%;
  padding: 15px;
}

/* Clear floats after the columns */
.row:after {
  content: "";
  display: table;
  clear: both;
}
@media screen and (max-width:1150px) {
  .column {
    width: 550px;
  }
}
#number {
	width: 3em;
}

</style>
<title>Tilor's Exotic Damage Calculator</title>
</head>
<body onLoad="listEntries()">

<h2>Exotic Damage Calculator</h2>
<p id="statCollection"></p>
<p id="items"></p>
<script>
var totalStats=[0,0,0,0,0,0,0,0,0];
const rarity = {
COMMON: 1,
UNCOMMON: 2,
RARE: 3,
VERY_RARE: 4,
ULTRA_RARE: 5,
EPIC: 6
};
var rarityIcons = ["Common_icon.png", "Uncommon_icon.png", "Rare_icon.png", "Very_rare_icon.png", "Ultra_rare_icon.png", "Epic_icon.png"];
const stats = {
EPG: 0,//"Exotic Particle Generator",
Cat1_EXOTIC: 1,//"Cat1 Exotic Damage",
Cat2_EXOTIC: 2,//"Cat2 Exotic Damage",
CrtD_EXOTIC: 3,//"Critical Damage - Exotic",
CrtH_EXOTIC: 4,//"Critical Hit Chance - Exotic",
AUX_POWER: 5,//"Auxiliary Power",
MAX_AUX_POWER: 6,//"Auxiliary Power Capacity Increase"
};
const statScaling = {
FIXED: "Fixed",
MARK_ONLY: "Mark Only",
MARK_AND_RARITY: "Mark and Rarity"
};
const ROMAN = [null,"_I_","_II_","_III_","_IV_","_V_","_VI_","_VII_","_VIII_","_IX_","_X_","_XI_","_XII_","_XIII_","_XIV_","_XV_","inf"];
var defaultMark = 15;
var defaultQty = 1;
var equipmentList = [ ];
var maxStats = 2;

equipmentList.push({name:"Console - Engineering - Conductive RCS Accelerator [EPG]",
mark:defaultMark,
rarity:rarity.EPIC,
icon:"Console_-_Engineering_-_Conductive_RCS_Accelerator_icon.png",
stat1:stats.EPG,
stat1type:statScaling.MARK_AND_RARITY,
stat1value:1.875,
quantity:1,
maxQty:1,
unique:false});

equipmentList.push({name:"Console - Science - Exotic Particle Field Exciter [EPG]",
mark:defaultMark,
rarity:rarity.EPIC,
icon:"Console_-_Science_-_Exotic_Particle_Field_Exciter_icon.png",
stat1:stats.EPG,
stat1type:statScaling.MARK_AND_RARITY,
stat1value:3.75,
quantity:1,
maxQty:1,
unique:false});

equipmentList.push({name:"Console - Science - Exotic Particle Field Exciter [not-EPG]",
mark:defaultMark,
rarity:rarity.EPIC,
icon:"Console_-_Science_-_Exotic_Particle_Field_Exciter_icon.png",
stat1:stats.EPG,
stat1type:statScaling.MARK_AND_RARITY,
stat1value:1.875,
quantity:1,
maxQty:1,
unique:false});

equipmentList.push({name:"Console - Science - Particle Generator",
mark:defaultMark,
rarity:rarity.EPIC,
icon:"Console_-_Science_-_Particle_Generator_icon.png",
stat1:stats.EPG,
stat1type:statScaling.MARK_AND_RARITY,
stat1value:1.875,
quantity:1,
maxQty:6,
unique:false});

equipmentList.push({name:"Console - Science - Shield Refrequencer [EPG]",
mark:defaultMark,
rarity:rarity.EPIC,
icon:"Console_-_Science_-_Shield_Refrequencer_icon.png",
stat1:stats.EPG,
stat1type:statScaling.MARK_AND_RARITY,
stat1value:1.25,
quantity:1,
maxQty:6,
unique:false});

equipmentList.push({name:"Console - Science - Threat Scaling Console",
mark:defaultMark,
rarity:rarity.EPIC,
icon:"Console_-_Science_-_Plasma-Generating_Weapon_Signature_Amplifier_icon.png",
stat1:stats.EPG,
stat1type:statScaling.MARK_AND_RARITY,
stat1value:1.875,
quantity:1,
maxQty:6,
unique:false});

equipmentList.push({name:"Console - Science - Exotic Particle Focuser [EPG Primary]",
mark:defaultMark,
rarity:rarity.EPIC,
icon:"Console_-_Science_-_Exotic_Particle_Focuser_icon.png",
stat1:stats.EPG,
stat1type:statScaling.MARK_AND_RARITY,
stat1value:1.875,
stat2:stats.Cat1_EXOTIC,
stat2type:statScaling.FIXED,
stat2value:0.075,
quantity:1,
maxQty:6,
unique:false});

equipmentList.push({name:"Console - Science - Exotic Particle Focuser [EPG Secondary]",
mark:defaultMark,
rarity:rarity.EPIC,
icon:"Console_-_Science_-_Exotic_Particle_Focuser_icon.png",
stat1:stats.EPG,
stat1type:statScaling.MARK_AND_RARITY,
stat1value:1.25,
stat2:stats.Cat1_EXOTIC,
stat2type:statScaling.FIXED,
stat2value:0.075,
quantity:1,
maxQty:6,
unique:false});

equipmentList.push({name:"Console - Science - Temporally Shielded Datacore",
mark:defaultMark,
rarity:rarity.EPIC,
icon:"Console_-_Science_-_Temporally_Shielded_Datacore_icon.png",
stat1:stats.EPG,
stat1type:statScaling.MARK_AND_RARITY,
stat1value:1.25,
quantity:1,
maxQty:1,
unique:false});

equipmentList.push({name:"Console - Tactical - Chronometric Capacitor",
mark:defaultMark,
rarity:rarity.EPIC,
icon:"Console_-_Tactical_-_Chronometric_Capacitor_icon.png",
stat1:stats.EPG,
stat1type:statScaling.MARK_AND_RARITY,
stat1value:1.875,
quantity:1,
maxQty:1,
unique:false});

equipmentList.push({name:"Console - Universal - Auxiliary Ejection Assembly",
mark:defaultMark,
rarity:rarity.EPIC,
icon:"Console_-_Universal_-_Auxiliary_Ejection_Assembly_icon.png",
stat1:stats.Cat2_EXOTIC,
stat1type:statScaling.FIXED,
stat1value:0.178,
quantity:1,
maxQty:1,
unique:true});

equipmentList.push({name:"Console - Universal - Disruption Pulse Emitter",
mark:defaultMark,
rarity:rarity.EPIC,
icon:"Console_-_Universal_-_Disruption_Pulse_Emitter_icon.png",
stat1:stats.EPG,
stat1type:statScaling.FIXED,
stat1value:20,
quantity:1,
maxQty:1,
unique:true});


function flipColor(cardID) {
	var backString = cardID.style.background;
	backString = backString.slice(4, backString.indexOf(")"));
	var seld;
	//if (cardID.innerHTML == equipmentList[0].name) {
	//	cardID.style.background = '#22CC22';
	//}
	if (backString == "0, 0, 0") {
		cardID.style.background = '#2222CC';
		seld = 1;
	}
	else {
		cardID.style.background = '#000000';
		seld = -1;
	}
	//alert(cardID.innerHTML.indexOf(equipmentList[0].name));
	for (var x = 0; x < equipmentList.length; x++) {
		if(cardID.innerHTML.indexOf(equipmentList[x].name) > -1) {
			sumStats(x,seld);
		}
	}
	updateTotals();
}
function rarClick(cardID,event) {
	event.stopPropagation();
var mainCard = cardID.parentNode.parentNode.parentNode;
var rarityUP = (cardID.value == "Upgrade Rarity");
var rarityCurrent;
var rarityNew;
	var backString = mainCard.style.background;
	backString = backString.slice(4, backString.indexOf(")"));
	if (backString != "0, 0, 0") {
		flipColor(mainCard);
	}
	for (var x = 0; x < equipmentList.length; x++) {
		if(mainCard.innerHTML.indexOf(equipmentList[x].name) > -1) {
			rarityCurrent = equipmentList[x].rarity;
		if (rarityUP) {
			rarityNew = Math.min(rarityCurrent + 1, 6);
			//alert("Power UP");
		}
		else if (!rarityUP) {
			rarityNew = Math.max(rarityCurrent - 1, 1);
			//alert("Power DOWN");
		}
		else {
			alert("There is an error with rarity selection");
		}
		equipmentList[x].rarity = rarityNew;
		mainCard.children[0].children[1].src = mainCard.children[0].children[1].src.replace(rarityIcons[rarityCurrent-1], rarityIcons[rarityNew-1]);
		}
	}
	if (backString != "0, 0, 0") {
		flipColor(mainCard);
	}
}

function upgClickSpin(cardID,event) {
	event.stopPropagation();
var mainCard = cardID.parentNode.parentNode.parentNode;
var markCurrent;
var markNew = cardID.value;
var backString = mainCard.style.background;
	backString = backString.slice(4, backString.indexOf(")"));
	if (backString != "0, 0, 0") {
		flipColor(mainCard);
	}
	for (var x = 0; x < equipmentList.length; x++) {
		if(mainCard.innerHTML.indexOf(equipmentList[x].name) > -1) {
			markCurrent = equipmentList[x].mark;
			equipmentList[x].mark = Number(markNew);
			mainCard.children[0].children[2].src = mainCard.children[0].children[2].src.replace(ROMAN[markCurrent], ROMAN[markNew]);
		}
	}
	if (backString != "0, 0, 0") {
		flipColor(mainCard);
	}
}

function qtyClickSpin(cardID,event) {
	event.stopPropagation();
var mainCard = cardID.parentNode.parentNode.parentNode;
var qtyCurrent;
var qtyNew = cardID.value;
var backString = mainCard.style.background;
	backString = backString.slice(4, backString.indexOf(")"));
	if (backString != "0, 0, 0") {
		flipColor(mainCard);
	}
	for (var x = 0; x < equipmentList.length; x++) {
		if(mainCard.innerHTML.indexOf(equipmentList[x].name) > -1) {
			qtyCurrent = equipmentList[x].quantity;
			equipmentList[x].quantity = Number(qtyNew);
		}
	}
	if (backString != "0, 0, 0") {
		flipColor(mainCard);
	}
}

function sumStats(itemNum,seld) {
			switch(equipmentList[itemNum].stat1type) {
				case statScaling.MARK_AND_RARITY:
				totalStats[equipmentList[itemNum].stat1] += seld * equipmentList[itemNum].quantity * equipmentList[itemNum].stat1value * (equipmentList[itemNum].rarity + equipmentList[itemNum].mark);
				break;
				case statScaling.MARK_ONLY:
				totalStats[equipmentList[itemNum].stat1] += seld * equipmentList[itemNum].quantity * equipmentList[itemNum].stat1value * (1 + equipmentList[itemNum].mark);
				break;
				case statScaling.FIXED:
				totalStats[equipmentList[itemNum].stat1] += seld * equipmentList[itemNum].quantity * equipmentList[itemNum].stat1value;
				break;
				default:
				}
			switch(equipmentList[itemNum].stat2type) {
				case statScaling.MARK_AND_RARITY:
				totalStats[equipmentList[itemNum].stat2] += seld * equipmentList[itemNum].quantity * equipmentList[itemNum].stat2value * (equipmentList[itemNum].rarity + equipmentList[itemNum].mark);
				break;
				case statScaling.MARK_ONLY:
				totalStats[equipmentList[itemNum].stat2] += seld * equipmentList[itemNum].quantity * equipmentList[itemNum].stat2value * (1 + equipmentList[itemNum].mark);
				break;
				case statScaling.FIXED:
				totalStats[equipmentList[itemNum].stat2] += seld * equipmentList[itemNum].quantity * equipmentList[itemNum].stat2value;
				break;
				default:
				}
}

function listEntries() {

var len = equipmentList.length;
//This is just temporary to to limited testing before selection
//for (var bloop = 1; bloop < len; bloop++) {
//equipmentList[bloop].rarity = Math.floor(Math.random() * 6) + 1;
//}

var baseMessage = '<div class="row">'+
'<div class="card" onClick="flipColor(this)" style="background: rgb(0, 0, 0);">'+
	'<div class="imageWrapper">'+
		'<img class="overlayImage" src="img/ITEM_ICON" alt="Icon">'+
		'<img class="overlayImage" src="img/RARITY_ICON" alt="Rarity" id="rarity_icon">'+
		'MK_INSTANCE'+
	'</div><div class="container">'+
		'<p style="margin-left: 57px; padding-top: 5px">BLURB<br>'+
		'SCALING_NOTE'+
		'QTY_NOTE' +
'</p></div></div></div>';
var messageData = "";
for (var x = 0; x < len; x++) {
messageData += baseMessage;


//Input the actual string and display card
if (equipmentList[x].icon != undefined) {
messageData = messageData.replace("ITEM_ICON", equipmentList[x].icon);
}
else
{
messageData = messageData.replace("ITEM_ICON", 'MissingNO_icon.png');
}
if (equipmentList[x].unique) {
messageData = messageData.replace('SCALING_NOTE', '');
messageData = messageData.replace('MK_INSTANCE', '');
}
else {
messageData = messageData.replace('SCALING_NOTE', ' Mark: <input type="number" value="15" min="1" max="15" onclick="upgClickSpin(this,event)" onkeyup="upgClickSpin(this,event)" id="number" required>'+
		'<input type="button" value="Upgrade Rarity" onClick="rarClick(this,event)">'+
		'<input type="button" value="Downgrade Rarity" onClick="rarClick(this,event)">');
messageData = messageData.replace('MK_INSTANCE', '<img class="overlayImage" src="img/MkMARK_ICONicon.png" alt="Mark" id="mk_icon">');
}

messageData = messageData.replace("RARITY_ICON", rarityIcons[equipmentList[x].rarity-1]);
messageData = messageData.replace("BLURB", equipmentList[x].name);
messageData = messageData.replace("MARK_ICON", ROMAN[equipmentList[x].mark]);
if (equipmentList[x].maxQty != 1) {
messageData = messageData.replace('QTY_NOTE', '<br>Quantity: <input type="number" value="1" min="1" max="'+ equipmentList[x].maxQty +'" onclick="qtyClickSpin(this,event)" onkeyup="qtyClickSpin(this,event)" id="number" required>');
}
else {
messageData = messageData.replace('QTY_NOTE', '');
}

}
document.getElementById('items').innerHTML = '<div class="column">' + messageData + '</div>';
//dummy placeholder for the output powers
document.getElementById('items').innerHTML += '<div class="column">' + 'Output Data<br>The results for powers will show up here' + '</div>';
updateTotals();
}
function updateTotals() {
var statData;
statData = "EPG: " + Math.round(totalStats[0]*1000)/1000 +
"<br>Cat1: " + Math.round(totalStats[1]*1000)/1000 + 
"<br>Cat2: " + Math.round(totalStats[2]*1000)/1000 + 
"<br>";
document.getElementById('statCollection').innerHTML = statData;
}
</script>

</body>
</html>
